version : 2

sources : 
  - name : raw
    schema : gz_raw_data
    description : Greenweez raw data source
    tables : 
      - name : sales
        freshness : 
          warn_after : {count : 90, period : day}
        loaded_at_field : "CAST(date_date AS TIMESTAMP)"
        identifier : raw_gz_sales
        description : All Greenweez sales between April 1st and September 30th 2021
        columns : 
          - name : date_date
            description : date on which each order have been made
          - name : CONCAT(orders_id, "_", pdt_id)
            description : Concatenation of orders_id and products_id to get our primary key
            tests : 
              - unique
              - not_null
          - name : orders_id
            description : ID given to each order
          - name : products_id
            description : ID of each product ordered
          - name : revenue
            description : revenue generated by each order
          - name : quantity
            description : quantity ordered of each product
      - name : product
        identifier : raw_gz_product
        description : Greenweez product catalogue 
        columns : 
          - name : products_id
            description : id for each product (= primary key)
            tests : 
              - unique
              - not_null
          - name : purchase_price
            description : The price that Greenweez have to pay for each product they're selling
      - name : ship
        identifier : raw_gz_ship
        description : shipments relative to each orders
        columns : 
          - name : orders_id
            description : unique ID given to each order (= primary key)
            tests : 
              - unique
              - not_null
          - name : shipping_fee
            description : fees paid by the customer to get his order ship
          - name : logcost
            description : logistic cost relative to each order
          - name : ship_cost
            description : shipping cost relative to each order
      - name : facebook
        identifier : raw_gz_facebook
        description : Costs and benefits from facebook campaigns
        columns : 
          - name : date_date
            description : date of each campaign
          - name : paid_source
            description : source of each campaign
          - name : campaign_key
            description : numeric key given to each campaign
          - name : CONCAT (campaign_key, "_", date_date)
            description : concatenation of campaign_key and date_date to get a unique primary key
            tests : 
              - unique
              - not_null
          - name : campaign_name
            description : name of each campaign
          - name : ads_cost
            description : cost of each campaign
          - name : impression
            description : number of impressions generated by each campaign
          - name : click
            description : number of clicks generated by each campaign
      - name : criteo
        identifier : raw_gz_criteo
        description : Costs and benefits from criteo campaigns
        columns :   
          - name : date_date
            description : date of each campaign
          - name : paid_source
            description : source of each campaign
          - name : campaign_key
            description : numeric key given to each campaign
          - name : CONCAT (campaign_key, "_", date_date)
            description : concatenation of campaign_key and date_date to get a unique primary key
            tests : 
              - unique
              - not_null
          - name : campaign_name
            description : name of each campaign
          - name : ads_cost
            description : cost of each campaign
          - name : impression
            description : number of impressions generated by each campaign
          - name : click
            description : number of clicks generated by each campaign
      - name : bing
        identifier : raw_gz_bing
        description : Costs and benefits from bing campaigns
        columns : 
          - name : date_date
            description : date of each campaign
          - name : paid_source
            description : source of each campaign
          - name : campaign_key
            description : numeric key given to each campaign
          - name : CONCAT (campaign_key, "_", date_date)
            description : concatenation of campaign_key and date_date to get a unique primary key
            tests : 
              - unique
              - not_null
          - name : campaign_name
            description : name of each campaign
          - name : ads_cost
            description : cost of each campaign
          - name : impression
            description : number of impressions generated by each campaign
          - name : click
            description : number of clicks generated by each campaign
      - name : adwords
        identifier : raw_gz_adwords
        description : Costs and benefits from adwords campaigns
        columns : 
          - name : date_date
            description : date of each campaign
          - name : paid_source
            description : source of each campaign
          - name : campaign_key
            description : numeric key given to each campaign
          - name : CONCAT (campaign_key, "_", date_date)
            description : concatenation of campaign_key and date_date to get a unique primary key
            tests : 
              - unique
              - not_null
          - name : campaign_name
            description : name of each campaign
          - name : ads_cost
            description : cost of each campaign
          - name : impression
            description : number of impressions generated by each campaign
          - name : click
            description : number of clicks generated by each campaign

models:
  - name: int_campaigns_day.sql
    description : aggregated version of int_campaigns model for each day
    columns : 
    - name : date_date
      description : date
      tests : 
        - unique
        - not_null
    - name : SUM (ads_cost)
      description : ads costs for each date
      tests : 
        - not_null
    - name : SUM (impression)
      description : number of impressions generated by ads for each date
      tests : 
        - not_null
    - name : SUM (click)
      description : number of clicks generated by ads for each date
      tests : 
        - not_null
  - name: finance_campaigns_day.sql
    description : joined table between finance_days and int_campaigns_day 
    columns : 
    - name : date_date
      description : date
      tests : 
        - unique
        - not_null
    - name : (operational_margin - ads_cost)
      description : ads margin per day
      tests : 
        - not_null
    - name : average_basket
      description : average basket per day
      tests : 
        - not_null
    - name : operational_margin
      description : operational margin per day
      tests : 
        - not_null